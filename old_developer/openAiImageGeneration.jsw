import axios from "axios";
// import { mediaManager } from "wix-media-backend";
import wixMedia from "wix-media-backend";
import sharp from 'sharp';
import wixData from 'wix-data';
const baseUrl = 'https://imageurl-69om.onrender.com';

// Function to generate image, resize, and upload
export const generateImage = async (prompt) => {
    const size = "1024x1024";
    const apiKey = "API_KEY"; // Replace with your actual API key
    const endpoint = "https://api.openai.com/v1/images/generations";

    try {
        // Generate image using OpenAI API
        const response = await axios.post(
            endpoint, { prompt, n: 1, size, model: "dall-e-3", quality: "standard", }, { headers: { "Content-Type": "application/json", Authorization: `Bearer ${apiKey}` } }
        );
        console.log("response",response)
        if (!response?.data?.data[0]) {
            throw response
        }
        return { url: response.data.data[0].url, success: true };
    } catch (error) {
        console.log("Error generating and uploading image:", error);
        return { url: '', success: false };
       
    }
};

export const uploadImageforCorrectDimension = async (url, width, height) => {
    const apiUrl = `${baseUrl}/uploadfile/file`;
    const data = {
        url,
        width,
        height
    };
    console.log(data)
    try {
        const response = await axios.post(apiUrl, data, {
            timeout: 0, // timeout in milliseconds, e.g., 10000 ms = 10 seconds
        });
        console.log("getImageWithCorrectDimension Response", response.data);
        if (response.data?.imageName)
            return response.data;
        else throw response;
    } catch (error) {
        console.log("error", error);
        return null;
    }
}